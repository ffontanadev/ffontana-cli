package {{packageName}};

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import java.util.Optional;
import java.util.List;
import java.util.Arrays;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyLong;
import static org.mockito.Mockito.*;

/**
 * Test class for {{className}}
 * Generated by ff-cli
 */
@ExtendWith(MockitoExtension.class)
@DisplayName("{{className}} Tests")
public class {{className}}Test {

    @InjectMocks
    private {{className}} {{classNameCamel}};

    {{#each dependencies}}
    @Mock
    private {{this}};
    {{/each}}

    @BeforeEach
    void setUp() {
        // Setup test data
    }

    {{#each methods}}
    @Test
    @DisplayName("{{description}}")
    public void test{{pascalCase name}}() {
        // Given
        {{#each parameters}}
        {{type}} {{name}} = {{#if (eq type "Long")}}1L{{else if (eq type "String")}}"test"{{else}}null{{/if}};
        {{/each}}

        {{#if mockSetup}}
        {{mockSetup}}
        {{/if}}

        // When
        {{#if (ne returnType "void")}}
        {{returnType}} result = {{../classNameCamel}}.{{name}}({{#each parameters}}{{name}}{{#unless @last}}, {{/unless}}{{/each}});
        {{else}}
        {{../classNameCamel}}.{{name}}({{#each parameters}}{{name}}{{#unless @last}}, {{/unless}}{{/each}});
        {{/if}}

        // Then
        {{#if (ne returnType "void")}}
        assertNotNull(result);
        {{/if}}

        {{#if verifyMock}}
        {{verifyMock}}
        {{/if}}
    }

    {{/each}}

    @Test
    @DisplayName("Find by ID - Not found scenario")
    public void testFindById_NotFound() {
        // Given
        Long id = 999L;
        when({{dependencies.[0]}}.findById(anyLong())).thenReturn(Optional.empty());

        // When
        Optional result = {{classNameCamel}}.findById(id);

        // Then
        assertTrue(result.isEmpty());
    }

    @Test
    @DisplayName("Save entity - Success")
    public void testSave_Success() {
        // Given
        Object entity = new Object();
        when({{dependencies.[0]}}.save(any())).thenReturn(entity);

        // When
        Object result = {{classNameCamel}}.save(entity);

        // Then
        assertNotNull(result);
        verify({{dependencies.[0]}}, times(1)).save(any());
    }
}
